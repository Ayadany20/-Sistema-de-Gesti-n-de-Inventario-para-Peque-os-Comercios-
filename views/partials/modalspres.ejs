<!--modals para proveedores.ejs -->
 <body class="has-background-white-bis has-text-black" style="display: flex; flex-direction: column; min-height: 100vh;">
<!-- Agregar agregar -->
<div id="modal-agregar" class="box" style="
  display: none;
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  z-index: 2000;
  width: 400px;
  max-width: 90%;
  text-align: left;
  padding: 2rem;
  box-shadow: 0 2px 8px rgba(0,0,0,0.3);
  background-color: white;
">
  <!-- Botón cerrar en la x  -->
  <button class="delete" style="position: absolute; top: 10px; right: 10px;" onclick="cerrarFormularioagrega()"></button>

  <h3 class="title is-4">Agregar Proveedor + </h3>
  
  <form id="form-agregar">
    <div class="field">
      <label class="label">Nombre</label>
      <div class="control">
        <input class="input" type="text" id="nombre-proveedor" name="nameproveedor" placeholder="Nombre" required>
      </div>
    </div>
     <div class="field">
      <label class="label">Contacto</label>
      <div class="control">
        <input class="input" type="text" id="contacto-proveedor" name="contacto" placeholder="Contacto">
      </div>
    </div>

    <div class="field">
      <label class="label">Dirección</label>
      <div class="control">
        <input class="input" type="text" id="direccion-proveedor" name="direccion" placeholder="Dirección">
      </div>
    </div>
    <!-- Botones -->
    <div class="field is-grouped is-justify-content-end" style="margin-top: 1rem;">
      <p class="control">
        <button type="submit" class="button is-success">Guardar</button>
      </p>
      <p class="control">
        <button type="button" class="button is-light" onclick="cerrarFormularioagrega()">Cancelar</button>
      </p>
    </div>
  </form>
</div>
<!-- Js para abrir y cerrar -->
<script>
  function mostrarFormularioagrega() {
    document.getElementById('modal-agregar').style.display = 'block';
  }

  function cerrarFormularioagrega() {
    document.getElementById('modal-agregar').style.display = 'none';
    // Limpiar el formulario
    document.getElementById('form-agregar').reset();
  }

  // Manejar el envío del formulario de agregar proveedor
  document.getElementById('form-agregar').addEventListener('submit', function (e) {
    e.preventDefault();
    
    // Obtener los datos del formulario
    const formData = {
      nameproveedor: document.getElementById('nombre-proveedor').value,
      contacto: document.getElementById('contacto-proveedor').value,
      direccion: document.getElementById('direccion-proveedor').value
    };

    // Enviar los datos al servidor
    fetch('/api/proveedores', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify(formData)
    })
    .then(response => response.json())
    .then(data => {
      if (data.error) {
        alert('Error: ' + data.error);
      } else {
        alert('Proveedor agregado exitosamente');
        cerrarFormularioagrega();
        // Recargar la página para mostrar el nuevo proveedor
        location.reload();
      }
    })
    .catch(error => {
      console.error('Error:', error);
      alert('Error al agregar el proveedor');
    });
  });
</script>
<!-- Editar -->
<div id="modal-editar" class="box" style="
  display: none;
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  z-index: 2000;
  width: 400px;
  max-width: 90%;
  text-align: left;
  padding: 2rem;
  box-shadow: 0 2px 8px rgba(0,0,0,0.3);
  background-color: white;
">
  <!-- Botón cerrar en la x  -->
  <button class="delete" style="position: absolute; top: 10px; right: 10px;" onclick="cerrarFormularioEditar()"></button>

  <h3 class="title is-4">Editar Proveedor</h3>
  
   <form id="form-editar">
    <input type="hidden" id="edit-proveedor-id" name="id">
    
    <div class="field">
      <label class="label">Nombre</label>
      <div class="control">
        <input class="input" type="text" id="edit-nombre-proveedor" name="nameproveedor" placeholder="Nombre" required>
      </div>
    </div>
     <div class="field">
      <label class="label">Contacto</label>
      <div class="control">
        <input class="input" type="text" id="edit-contacto-proveedor" name="contacto" placeholder="Contacto">
      </div>
    </div>

    <div class="field">
      <label class="label">Dirección</label>
      <div class="control">
        <input class="input" type="text" id="edit-direccion-proveedor" name="direccion" placeholder="Dirección">
      </div>
    </div>

    <!-- Botones -->
    <div class="field is-grouped is-justify-content-end" style="margin-top: 1rem;">
      <p class="control">
        <button type="submit" class="button is-success">Guardar</button>
      </p>
      <p class="control">
        <button type="button" class="button is-light" onclick="cerrarFormularioEditar()">Cancelar</button>
      </p>
    </div>
  </form>
</div>
<!-- JS para abrir y cerrar edición -->
<script>
  let idProveedorAEditar = null;

  function mostrarFormularioEditar(id) {
    idProveedorAEditar = id;
    
    // Obtener los datos del proveedor
    fetch(`/api/proveedores/${id}`)
      .then(response => response.json())
      .then(proveedor => {
        // Llenar el formulario con los datos del proveedor
        document.getElementById('edit-proveedor-id').value = proveedor.proveedorId;
        document.getElementById('edit-nombre-proveedor').value = proveedor.nameproveedor;
        document.getElementById('edit-contacto-proveedor').value = proveedor.contacto || '';
        document.getElementById('edit-direccion-proveedor').value = proveedor.direccion || '';
        
        // Mostrar el modal
        document.getElementById('modal-editar').style.display = 'block';
      })
      .catch(error => {
        console.error('Error:', error);
        alert('Error al cargar los datos del proveedor');
      });
  }

  function cerrarFormularioEditar() {
    document.getElementById('modal-editar').style.display = 'none';
    idProveedorAEditar = null;
    document.getElementById('form-editar').reset();
  }

  // Manejar el envío del formulario de edición
  document.getElementById('form-editar').addEventListener('submit', function (e) {
    e.preventDefault();
    
    if (!idProveedorAEditar) return;
    
    // Obtener los datos del formulario
    const formData = {
      nameproveedor: document.getElementById('edit-nombre-proveedor').value,
      contacto: document.getElementById('edit-contacto-proveedor').value,
      direccion: document.getElementById('edit-direccion-proveedor').value
    };

    // Enviar los datos al servidor
    fetch(`/api/proveedores/${idProveedorAEditar}`, {
      method: 'PUT',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify(formData)
    })
    .then(response => response.json())
    .then(data => {
      if (data.error) {
        alert('Error: ' + data.error);
      } else {
        alert('Proveedor actualizado exitosamente');
        cerrarFormularioEditar();
        // Recargar la página para mostrar los cambios
        location.reload();
      }
    })
    .catch(error => {
      console.error('Error:', error);
      alert('Error al actualizar el proveedor');
    });
  });
</script>
<!-- Modal de eliminación -->
<div id="modal-confirmar-eliminar" style="
  display: none;
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  z-index: 2000;
  background: white;
  padding: 2rem;
  border-radius: 10px;
  box-shadow: 0 0 20px rgba(0,0,0,0.3);
  width: 320px;
  max-width: 90%;
  text-align: center;
">
  <p style="margin-bottom: 1.5rem;"><strong>¿Estás seguro de que quieres eliminar este elemento?</strong></p>
  <button class="button is-danger" id="btn-confirmar-eliminar">Sí, eliminar</button>
  <button class="button is-light" onclick="cerrarConfirmacionn()">Cancelar</button>
</div>
<script>
  let idAEliminar = null;

  function confirmarEliminarr(id) {
    idAEliminar = id;
    document.getElementById('modal-confirmar-eliminar').style.display = 'block';
  }

  function cerrarConfirmacionn() {
    idAEliminar = null;
    document.getElementById('modal-confirmar-eliminar').style.display = 'none';
  }

  document.getElementById('btn-confirmar-eliminar').addEventListener('click', () => {
    if (idAEliminar) {
      // Eliminar proveedor usando la API
      fetch(`/api/proveedores/${idAEliminar}`, {
        method: 'DELETE',
        headers: {
          'Content-Type': 'application/json',
        }
      })
      .then(response => response.json())
      .then(data => {
        if (data.error) {
          alert('Error: ' + data.error);
        } else {
          alert('Proveedor eliminado exitosamente');
          cerrarConfirmacionn();
          // Recargar la página para actualizar la lista
          location.reload();
        }
      })
      .catch(error => {
        console.error('Error:', error);
        alert('Error al eliminar el proveedor');
      });
    }
  });
</script>

 </body>